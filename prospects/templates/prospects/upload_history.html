{% extends "base.html" %}

{% block title %}Historique des imports{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 py-8">
  <!-- Retour -->
  <div class="mb-6">
    <a href="{% url 'prospects:list' %}" class="text-blue-600 hover:text-blue-700 font-medium">
      â† Retour Ã  la liste des prospects
    </a>
  </div>

  <!-- En-tÃªte -->
  <div class="mb-8">
    <h1 class="text-4xl font-bold text-slate-900">ğŸ“‹ Historique des imports</h1>
    <p class="text-slate-500 mt-2">Suivi de tous les uploads CSV effectuÃ©s</p>
  </div>

  <!-- Tableau d'historique -->
  {% if uploads %}
  <div class="bg-white rounded-lg shadow overflow-hidden">
    <table class="w-full">
      <thead class="bg-slate-100 border-b border-slate-200">
        <tr>
          <th class="px-6 py-3 text-left text-sm font-semibold text-slate-900">Fichier</th>
          <th class="px-6 py-3 text-center text-sm font-semibold text-slate-900">Date</th>
          <th class="px-6 py-3 text-center text-sm font-semibold text-green-600">CrÃ©Ã©s</th>
          <th class="px-6 py-3 text-center text-sm font-semibold text-blue-600">FusionnÃ©s</th>
          <th class="px-6 py-3 text-center text-sm font-semibold text-orange-600">Doublons</th>
          <th class="px-6 py-3 text-center text-sm font-semibold text-red-600">Erreurs</th>
          <th class="px-6 py-3 text-center text-sm font-semibold text-slate-900">Action</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-200">
        {% for upload in uploads %}
        <tr class="hover:bg-slate-50 transition">
          <td class="px-6 py-4 text-sm font-medium text-slate-900">
            {{ upload.filename }}
          </td>
          <td class="px-6 py-4 text-sm text-center text-slate-600">
            {{ upload.created_at|date:"d/m/Y H:i" }}
          </td>
          <td class="px-6 py-4 text-sm text-center">
            <span class="inline-block bg-green-100 text-green-800 px-3 py-1 rounded-full font-semibold">
              {{ upload.created_count }}
            </span>
          </td>
          <td class="px-6 py-4 text-sm text-center">
            <span class="inline-block bg-blue-100 text-blue-800 px-3 py-1 rounded-full font-semibold">
              {{ upload.updated_count }}
            </span>
          </td>
          <td class="px-6 py-4 text-sm text-center">
            <span class="inline-block bg-orange-100 text-orange-800 px-3 py-1 rounded-full font-semibold">
              {{ upload.duplicates_count }}
            </span>
          </td>
          <td class="px-6 py-4 text-sm text-center">
            <span class="inline-block {% if upload.errors_count > 0 %}bg-red-100 text-red-800{% else %}bg-slate-100 text-slate-800{% endif %} px-3 py-1 rounded-full font-semibold">
              {{ upload.errors_count }}
            </span>
          </td>
          <td class="px-6 py-4 text-sm text-center">
            <a href="{% url 'prospects:upload_detail' upload.id %}" class="text-blue-600 hover:text-blue-700 font-medium hover:underline">
              Voir dÃ©tails
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  {% if page_obj.has_other_pages %}
  <div class="mt-6 flex justify-center gap-2">
    {% if page_obj.has_previous %}
    <a href="?page=1" class="px-3 py-2 bg-slate-200 text-slate-900 rounded hover:bg-slate-300">Â«</a>
    <a href="?page={{ page_obj.previous_page_number }}" class="px-3 py-2 bg-slate-200 text-slate-900 rounded hover:bg-slate-300">â€¹</a>
    {% endif %}

    <span class="px-3 py-2">Page {{ page_obj.number }} sur {{ page_obj.paginator.num_pages }}</span>

    {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}" class="px-3 py-2 bg-slate-200 text-slate-900 rounded hover:bg-slate-300">â€º</a>
    <a href="?page={{ page_obj.paginator.num_pages }}" class="px-3 py-2 bg-slate-200 text-slate-900 rounded hover:bg-slate-300">Â»</a>
    {% endif %}
  </div>
  {% endif %}

  {% else %}
  <div class="bg-slate-50 border border-slate-200 rounded-lg p-8 text-center">
    <p class="text-slate-600">Aucun import n'a Ã©tÃ© effectuÃ© pour le moment.</p>
  </div>
  {% endif %}
</div>
{% endblock %}
